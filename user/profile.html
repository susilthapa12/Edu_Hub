<!DOCTYPE html>
<html lang="en" x-data="profileApp()" x-init="init()" :class="{ 'dark': darkMode }" class="scroll-smooth bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-500">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Educational Platform - User Profile</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js CDN -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <style>
    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(107, 114, 128, 0.5);
      border-radius: 10px;
    }

    /* Drag & Drop area highlight */
    .dragover {
      border-color: #22c55e !important;
      background-color: #dcfce7 !important;
    }

    /* Tooltip */
    .tooltip {
      position: relative;
      cursor: help;
    }
    .tooltip .tooltip-text {
      visibility: hidden;
      opacity: 0;
      width: max-content;
      max-width: 220px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 6px 8px;
      position: absolute;
      z-index: 10;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      transition: opacity 0.3s;
      pointer-events: none;
      font-size: 0.75rem;
      line-height: 1.2;
      user-select: none;
    }
    .tooltip:hover .tooltip-text,
    .tooltip:focus-within .tooltip-text {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }

    /* Spinner */
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-top: 4px solid #22c55e;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="flex justify-between items-center px-6 py-4 bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50">
    <h1 class="text-2xl font-extrabold select-none">User Profile</h1>
    <button
      @click="toggleDarkMode"
      :aria-pressed="darkMode.toString()"
      aria-label="Toggle Dark Mode"
      class="p-2 rounded focus:outline-none focus:ring-2 focus:ring-green-500"
      title="Toggle Dark Mode"
    >
      <template x-if="!darkMode">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-9h1M3 12H2m15.364-6.364l.707.707M6.343 17.657l-.707.707M17.657 17.657l.707-.707M6.343 6.343l-.707-.707M12 7a5 5 0 000 10 5 5 0 000-10z" /></svg>
      </template>
      <template x-if="darkMode">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400" fill="currentColor" viewBox="0 0 24 24" stroke="none"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
      </template>
    </button>
  </header>

  <!-- Main Form -->
  <main class="flex-grow max-w-4xl mx-auto p-6 md:p-12">
    <form @submit.prevent="submitForm" novalidate class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 md:p-10 space-y-8" aria-label="User Profile Form" role="form" aria-live="polite">

      <!-- Avatar Upload -->
      <fieldset>
        <legend class="text-xl font-semibold mb-4 select-none">Profile Picture</legend>

        <div
          @dragover.prevent="dragOver = true"
          @dragleave.prevent="dragOver = false"
          @drop.prevent="handleDrop($event)"
          :class="{'dragover': dragOver}"
          tabindex="0"
          aria-label="Drag and drop profile picture area. Or click to select file."
          role="button"
          @click="triggerFileInput"
          @keydown.enter.prevent="triggerFileInput"
          @keydown.space.prevent="triggerFileInput"
          class="border-2 border-dashed border-gray-400 dark:border-gray-600 rounded-lg flex flex-col items-center justify-center cursor-pointer aspect-square max-w-xs mx-auto p-4 focus:outline-none focus:ring-4 focus:ring-green-500 transition-colors"
        >
          <template x-if="avatarPreview">
            <img :src="avatarPreview" alt="User profile picture preview" class="rounded-full w-40 h-40 object-cover shadow-lg" />
          </template>
          <template x-if="!avatarPreview">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A7.972 7.972 0 0112 15a7.972 7.972 0 016.879 2.804M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            <p class="mt-3 text-center text-gray-500 dark:text-gray-400 select-none">Drag & drop or click to upload avatar</p>
          </template>
          <input type="file" accept="image/*" class="hidden" @change="handleFileChange" x-ref="fileInput" aria-hidden="true" />
        </div>
        <p class="mt-2 text-center text-gray-500 dark:text-gray-400 text-sm select-none">Allowed file types: JPG, PNG, GIF. Max size: 2MB.</p>
        <p class="mt-1 text-center text-red-500 text-sm" x-text="avatarError" role="alert" aria-live="assertive"></p>
      </fieldset>

      <!-- User Details -->
      <fieldset>
        <legend class="text-xl font-semibold mb-4 select-none">Personal Information</legend>
        <div class="grid gap-6 md:grid-cols-2">

          <div class="relative tooltip">
            <label for="name" class="block font-medium mb-1">Full Name <span class="text-red-500">*</span></label>
            <input
              id="name"
              type="text"
              placeholder="Your full name"
              x-model.trim="form.name"
              required
              autocomplete="name"
              @input="validateField('name')"
              class="w-full rounded border border-gray-300 dark:border-gray-600 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-gray-100"
            />
            <div class="tooltip-text">Enter your full legal name.</div>
            <p class="mt-1 text-red-500 text-sm" x-text="errors.name" role="alert" aria-live="assertive"></p>
          </div>

          <div class="relative tooltip">
            <label for="email" class="block font-medium mb-1">Email Address <span class="text-red-500">*</span></label>
            <input
              id="email"
              type="email"
              placeholder="you@example.com"
              x-model.trim="form.email"
              required
              autocomplete="email"
              @input="validateField('email')"
              class="w-full rounded border border-gray-300 dark:border-gray-600 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-gray-100"
            />
            <div class="tooltip-text">We'll never share your email.</div>
            <p class="mt-1 text-red-500 text-sm" x-text="errors.email" role="alert" aria-live="assertive"></p>
          </div>

          <div class="relative tooltip">
            <label for="phone" class="block font-medium mb-1">Phone Number</label>
            <input
              id="phone"
              type="tel"
              placeholder="+123 456 7890"
              x-model.trim="form.phone"
              autocomplete="tel"
              @input="validateField('phone')"
              class="w-full rounded border border-gray-300 dark:border-gray-600 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-gray-100"
              pattern="^\+?[0-9\s\-]{7,15}$"
              title="Phone number with country code"
            />
            <div class="tooltip-text">Optional, include country code.</div>
            <p class="mt-1 text-red-500 text-sm" x-text="errors.phone" role="alert" aria-live="assertive"></p>
          </div>

          <div class="relative tooltip">
            <label for="address" class="block font-medium mb-1">Address</label>
            <textarea
              id="address"
              placeholder="Your full address"
              x-model.trim="form.address"
              rows="3"
              @input="validateField('address')"
              class="w-full rounded border border-gray-300 dark:border-gray-600 px-4 py-2 resize-none focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-gray-100"
            ></textarea>
            <div class="tooltip-text">Optional, helps us customize your experience.</div>
            <p class="mt-1 text-red-500 text-sm" x-text="errors.address" role="alert" aria-live="assertive"></p>
          </div>
        </div>
      </fieldset>

      <!-- Password Section -->
      <fieldset>
        <legend class="text-xl font-semibold mb-4 select-none">Change Password</legend>

        <div class="space-y-4 max-w-md mx-auto">
          <div class="relative tooltip">
            <label for="password" class="block font-medium mb-1">New Password</label>
            <input
              id="password"
              type="password"
              placeholder="Enter new password"
              x-model="form.password"
              @input="checkPasswordStrength(); validateField('password')"
              autocomplete="new-password"
              class="w-full rounded border border-gray-300 dark:border-gray-600 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-gray-100"
              aria-describedby="passwordHelp"
            />
            <div class="tooltip-text">At least 8 characters, mix of uppercase, lowercase, digits & symbols.</div>
            <p class="mt-1 text-red-500 text-sm" x-text="errors.password" role="alert" aria-live="assertive"></p>
            <progress max="100" :value="passwordStrength" class="w-full mt-2 h-2 rounded bg-gray-300 dark:bg-gray-600 overflow-hidden"></progress>
            <p class="text-sm mt-1" x-text="passwordStrengthLabel" :class="passwordStrength < 40 ? 'text-red-500' : passwordStrength < 70 ? 'text-yellow-400' : 'text-green-500'"></p>
          </div>

          <div class="relative tooltip">
            <label for="passwordConfirm" class="block font-medium mb-1">Confirm New Password</label>
            <input
              id="passwordConfirm"
              type="password"
              placeholder="Re-enter new password"
              x-model="form.passwordConfirm"
              @input="validateField('passwordConfirm')"
              autocomplete="new-password"
              class="w-full rounded border border-gray-300 dark:border-gray-600 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-gray-100"
            />
            <p class="mt-1 text-red-500 text-sm" x-text="errors.passwordConfirm" role="alert" aria-live="assertive"></p>
          </div>
        </div>
      </fieldset>

      <!-- Buttons -->
      <div class="flex justify-center gap-4 flex-wrap">
        <button
          type="submit"
          :disabled="saving"
          class="bg-green-500 disabled:bg-green-300 text-white font-semibold px-8 py-3 rounded-lg shadow hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-400 transition-colors flex items-center justify-center gap-2"
          aria-live="polite"
          aria-busy="saving"
        >
          <template x-if="saving">
            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
            </svg>
          </template>
          <span x-text="saving ? 'Saving...' : 'Save Profile'"></span>
        </button>

        <button
          type="button"
          @click="resetForm()"
          :disabled="saving"
          class="bg-gray-500 disabled:bg-gray-300 text-white font-semibold px-8 py-3 rounded-lg shadow hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-colors"
        >
          Reset
        </button>
      </div>

    </form>
  </main>

  <!-- Toast Notifications -->
  <div
    x-show="toast.visible"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 translate-y-2"
    x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 translate-y-2"
    class="fixed bottom-8 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded shadow-lg text-white text-sm select-none z-50"
    :class="{
      'bg-green-500': toast.type === 'success',
      'bg-red-500': toast.type === 'error',
      'bg-yellow-400 text-gray-900': toast.type === 'warning'
    }"
    role="alert"
    aria-live="assertive"
    aria-atomic="true"
  >
    <p x-text="toast.message"></p>
  </div>

  <script>
    function profileApp() {
      return {
        darkMode: window.matchMedia('(prefers-color-scheme: dark)').matches || localStorage.getItem('darkMode') === 'true',
        dragOver: false,
        avatarPreview: null,
        avatarFile: null,
        avatarError: '',
        saving: false,
        passwordStrength: 0,
        passwordStrengthLabel: '',
        toast: {
          visible: false,
          message: '',
          type: 'success',
          timeout: null
        },
        form: {
          name: '',
          email: '',
          phone: '',
          address: '',
          password: '',
          passwordConfirm: '',
        },
        errors: {},

        init() {
          this.loadDraft();
          if(this.darkMode) document.documentElement.classList.add('dark');

          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            this.darkMode = e.matches;
            this.applyDarkMode();
          });

          // Autosave every 5 seconds
          this.autosaveInterval = setInterval(() => {
            this.saveDraft();
          }, 5000);
        },

        toggleDarkMode() {
          this.darkMode = !this.darkMode;
          this.applyDarkMode();
          localStorage.setItem('darkMode', this.darkMode);
        },

        applyDarkMode() {
          if (this.darkMode) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        },

        triggerFileInput() {
          this.$refs.fileInput.click();
        },

        handleFileChange(event) {
          const file = event.target.files[0];
          this.processFile(file);
        },

        handleDrop(event) {
          this.dragOver = false;
          const file = event.dataTransfer.files[0];
          this.processFile(file);
        },

        processFile(file) {
          this.avatarError = '';
          if (!file) return;

          const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
          if (!validTypes.includes(file.type)) {
            this.avatarError = 'Invalid file type. Use JPG, PNG, or GIF.';
            return;
          }
          if (file.size > 2 * 1024 * 1024) {
            this.avatarError = 'File too large. Max 2MB allowed.';
            return;
          }
          this.avatarFile = file;
          const reader = new FileReader();
          reader.onload = e => {
            this.avatarPreview = e.target.result;
            this.saveDraft();
          };
          reader.readAsDataURL(file);
        },

        validateField(field) {
          this.errors[field] = '';

          switch(field) {
            case 'name':
              if (!this.form.name) {
                this.errors.name = 'Name is required.';
              } else if (this.form.name.length < 3) {
                this.errors.name = 'Name must be at least 3 characters.';
              }
              break;

            case 'email':
              if (!this.form.email) {
                this.errors.email = 'Email is required.';
              } else if (!this.isValidEmail(this.form.email)) {
                this.errors.email = 'Invalid email address.';
              }
              break;

            case 'phone':
              if (this.form.phone && !/^\+?[0-9\s\-]{7,15}$/.test(this.form.phone)) {
                this.errors.phone = 'Invalid phone number.';
              }
              break;

            case 'address':
              // Optional, no validation
              break;

            case 'password':
              if (this.form.password && this.form.password.length < 8) {
                this.errors.password = 'Password must be at least 8 characters.';
              }
              if (this.form.password && this.form.passwordConfirm && this.form.password !== this.form.passwordConfirm) {
                this.errors.passwordConfirm = 'Passwords do not match.';
              } else {
                this.errors.passwordConfirm = '';
              }
              break;

            case 'passwordConfirm':
              if (this.form.password !== this.form.passwordConfirm) {
                this.errors.passwordConfirm = 'Passwords do not match.';
              }
              break;
          }
        },

        isValidEmail(email) {
          const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return re.test(email.toLowerCase());
        },

        checkPasswordStrength() {
          let strength = 0;
          const val = this.form.password;

          if (!val) {
            this.passwordStrength = 0;
            this.passwordStrengthLabel = '';
            return;
          }
          if (val.length >= 8) strength += 25;
          if (/[A-Z]/.test(val)) strength += 20;
          if (/[a-z]/.test(val)) strength += 20;
          if (/[0-9]/.test(val)) strength += 20;
          if (/[^A-Za-z0-9]/.test(val)) strength += 15;

          this.passwordStrength = Math.min(strength, 100);

          if (strength < 40) this.passwordStrengthLabel = 'Weak';
          else if (strength < 70) this.passwordStrengthLabel = 'Moderate';
          else this.passwordStrengthLabel = 'Strong';
        },

        validateForm() {
          // Validate all required fields
          this.validateField('name');
          this.validateField('email');
          this.validateField('phone');
          this.validateField('address');
          this.validateField('password');
          this.validateField('passwordConfirm');

          return Object.values(this.errors).every(err => !err);
        },

        submitForm() {
          if (this.saving) return;
          if (!this.validateForm()) {
            this.showToast('Please fix validation errors before submitting.', 'error');
            return;
          }

          this.saving = true;
          // Simulate async save call (e.g., API request)
          setTimeout(() => {
            this.saving = false;
            this.showToast('Profile saved successfully!', 'success');
            this.saveDraft();
          }, 1500);
        },

        saveDraft() {
          try {
            const data = {
              form: this.form,
              avatarPreview: this.avatarPreview
            };
            localStorage.setItem('eduProfileDraft', JSON.stringify(data));
          } catch (e) {
            // Ignore errors
          }
        },

        loadDraft() {
          try {
            const saved = localStorage.getItem('eduProfileDraft');
            if (!saved) return;
            const data = JSON.parse(saved);

            if (data.form) this.form = data.form;
            if (data.avatarPreview) this.avatarPreview = data.avatarPreview;

            // Run initial validations on loaded data
            this.checkPasswordStrength();
            this.validateForm();
          } catch (e) {
            // Ignore errors
          }
        },

        resetForm() {
          if (this.saving) return;
          this.form = {
            name: '',
            email: '',
            phone: '',
            address: '',
            password: '',
            passwordConfirm: '',
          };
          this.avatarFile = null;
          this.avatarPreview = null;
          this.avatarError = '';
          this.errors = {};
          this.passwordStrength = 0;
          this.passwordStrengthLabel = '';
          localStorage.removeItem('eduProfileDraft');
          this.showToast('Form reset.', 'warning');
        },

        showToast(message, type = 'success') {
          clearTimeout(this.toast.timeout);
          this.toast.message = message;
          this.toast.type = type;
          this.toast.visible = true;
          this.toast.timeout = setTimeout(() => this.toast.visible = false, 4000);
        }
      }
    }
  </script>

</body>
</html>
